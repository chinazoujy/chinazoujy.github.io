---
layout: post
title: "SQL 注入笔记"
data: 2014-12-24
categories: web SQL
tag: web security
---

在用户登陆的过程中，需要对用户提交的输入进行下列的处理：
1. 应用程序收到用户的登录信息。表单处理程序确认每个输入仅包含合法字符，符合特殊的长度限制，并且不包含任何已知的攻击签名。
2. 应用程序执行一个SQL 查询检验用户证书。为防止SQL注入攻击，在执行查询前，应用程序应对用户输入中包含的可用于攻击数据库的所有字符进行转义。
3. 如果用户成功登录，应用程序再将用户资料中的某些数据传送给SOAP服务，进一步获得用户账户的有关信息。为防止SOAP注入攻击，需要对用户资料中的任何XML元字符进行适当编码。
4. 应用程序在用户的浏览器中显示用户的账户信息。为防止跨站点脚本攻击，应用程序对值入返回页面的任何用户提交的数据执行HTMl 编码。


HTTP 请求解析：
- 每个HTTP请求的第一行都由3个以空格间隔的项目组成。其中一个说明HTTP方法的动词，最常用的方法是GET，主要作用是从WEB 服务器获取一个资源。GET请求并没有消息主体，因此在消息头后的空白行中没有其他数据;所请求的URL。这个URL通常由所请求的资源名称，以及一个包含客户端向该资源提交的参数的可选查询字符串组成，在该URL中，查询字符串以?字符标识；使用的HTTP版本，因特网上常用的HTTP版本是1.0，1.1，多数浏览器默认使用1.1版本。这两个版本的规范之间存在一些差异，然而，当攻击WEB应用程序时候，渗透测试员可能遇到的唯一差异是1.1版本必须使用HOST 请求头。

Referer 消息头用于表示发出请求的原始URL（例如，因为用户单击页面上的一个链接）。注意的是，在最初的HTTP规范中，这个消息头存在拼写错误，并且这个错误一直保留了下来。

User-Agent消息头提供与浏览器或其他生成请求的客户端软件有关的信息。由于历史原因，大多数浏览器中都包含Mozilla前缀，这是因为最初占支配地位的Netscape浏览器使用了User-Agent字符串，而其他浏览器也希望让Web站点与这种标准兼容。这是计算机许多怪异现象是一样的。IE也保留了这一做法

Host 消息头用于指定出现在被访问的完整URL 中的主机名称，如果几个Web 站点以相同的一台服务器为主机，就需要使用Host 消息头，因为请求第一行中的URL 内通常并不包含主机名称

Cookie 消息头用于提交服务器向客户端发布的其他参数。

Accept 用于告诉服务器客户端愿意接受哪些内容，如图像类型，办公文档格式等。

Accept-Encoding 用于告诉服务器，客户端愿意接受哪些内容编码。

Authorization 用于为一种内置HTTP 身份验证向服务器提交证书。

If-Modified-Since  用于说明浏览器最后一次收到所请求的资源的时间。如果自那以后资源没有发生变化，服务器就会发生一个带状态码304的响应，指示客户端使用资源的缓存副本。

origin 用在跨域Ajax 请求中，用于指示提出请求的域


HTTP 响应：
第一行由3个以空格间隔的项目组成：
	使用的HTTP版本
	表示请求结果的数字状态码。200是最常用的状态码，表示成功提交了请求，正在返回所请求的资源。
	一段文本形式的“原因短语”，进一步说明响应状态，这个短语中可包含任何值，当前浏览器不将其用于任何目的。
	
注意要点：
	Server 消息头中包含一个旗标，指明所使用的web服务器软件，有时还包括其他信息，如所安装的模块和服务器操作系统，其中包含的信息可能并不准确。
	set-cookie 消息头向浏览器发送另一个cookie， 它将在随后向服务器发送的请求中由cookie 消息头返回。
	pragma 消息头指示浏览器不要将响应保存在缓存中。expires消息头指出响应内容已经过期，因此不应保存在缓存中，当返回动态内容时常常会发送这些指令，以确保浏览器随时获得最新内容。
	几乎所有的HTTP响应在消息头后的空白行下面都包含消息主体，content-type消息头表示这个消息主体中包含一个HTML文档。
	content-length 消息头规定消息主体的字节长度。
	Access-Control-Allow-Origin 用于指示可否通过Ajax 请求获取资源
	Cache-Control 用于向浏览器传送缓存指令（如：no-cache）
	ETag 用于指定一个实体标签，客户端可在将来的请求中提交这个表示符，获得和If-None-Match消息头中相同的资源，通知服务器浏览器当前缓存中保存的是哪个版本的资源
	Expires 用于向浏览器说明消息主体内容的有效时间，在这个时间之前，浏览器可以使用这个资源的缓存副本Location 用于在重定向响应（状态码以3开头的响应）	


GET 和POST差异：
	1.GET方法的作用在于获取资源。POST方法主要用于执行操作


状态码：
	1XX —— 提供信息
	2XX —— 请求被成功提交
	3XX —— 客户端被重定向到其他资源
	4XX —— 请求包含各种错误
	5XX —— 服务器执行请求时遇到错误。
	
	100 Continue: 当客户端提交一个包含主体的请求时，将发送这个响应，该响应表示已收到请求消息头，客户端应继续发送主体，请求完成后，再由服务器返回另一个响应。
	200 OK： 本状态码表示已成功提交请求，且响应主体中包含请求结果
	201 Created： PUT 请求的响应返回这个状态码，表示请求已成功提交
	301 Moved Permanently ： 本状态码将浏览器永久重定向到另外一个在Location 消息头中指定的URL， 以后客户端应使用新URL 替换原始的URL
	302 Found：本状态码将浏览器暂时重定向到另一个在Location 消息头中指定的URL， 客户端应在随后的请求中恢复使用原始的URL
	304 Not Modified : 本状态码指示浏览器使用缓存中保存的所请求资源的副本。服务器使用If-Modified-Since与 If-None-Match消息头确定客户端是否拥有最新版本的资源
	400 Bad Request： 本状态码表示客户端提交了一个无效的HTTP请求，当以某种无效的方式修改请求时（例如在URL 中插入一个空格符），可能会遇到这个状态码
	401 Unauthorized 服务器在许可请求前要求HTTP 进行身份验证WWW-Authenticate 消息头详细说明所支持的身份验证类型。
	403 Forbidden 不管是否通过验证，禁止任何人访问被请求的资源
	404 Not found 表示所请求的资源并不存在	
	405 Method not allowed 表示指定的URL 不支持请求中使用的方法。例如如果试图在不支持PUT方法的地方使用该方法，就会收到本状态码。
	413 Request Entity too large 如果在本地代码中探查缓冲器溢出漏洞并就此提交超长数据串，则本状态码表示请求主体过长，服务器无法处理
	414 Request URI Too long 与前一个响应类似，本状态码表示请求中的URL过长，服务器无法处理
	500 Internet server Error 本状态码表示服务器在执行请求时遇到错误。当提交无法预料的输入、在应用程序处理过程中造成无法处理的错误时，通常会收到本状态码。应该仔细检查服务器响应的所有内容，了解与错误性质有关的详情。
	503 service unavilable 本状态码表示尽管WEB 服务器运转正常，并且能够响应请求，但服务器访问的应用程序还是无法作出响应。应该进行核实，是否因为执行了某种行为而造成这个结果

URL编码字符：
	%3d: =
	%25:%
	%20:空格
	%0a:新的一行
	%00:空字节


























